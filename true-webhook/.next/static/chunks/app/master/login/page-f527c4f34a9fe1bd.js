(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[311],{2435:(e,a,s)=>{Promise.resolve().then(s.bind(s,3565))},3565:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>l});var t=s(5155),r=s(2115),n=s(6046);function l(){let e=(0,n.useRouter)(),[a,s]=(0,r.useState)(!1),[l,i]=(0,r.useState)(!1),[u,o]=(0,r.useState)(!0),[c,m]=(0,r.useState)(""),[d,h]=(0,r.useState)(""),[p,f]=(0,r.useState)(""),[N,g]=(0,r.useState)("");(0,r.useEffect)(()=>{fetch("/api/master/auth/setup-status").then(e=>e.json()).then(e=>{i(e.needsSetup),s(e.needsSetup),o(!1)}).catch(()=>o(!1))},[]);let j=async s=>{s.preventDefault(),m(""),o(!0);try{let s=a?{email:d,password:p,displayName:N}:{email:d,password:p},t=await fetch(a?"/api/master/auth/setup":"/api/master/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),r=await t.json();if(!r.ok){m("INVALID_CREDENTIALS"===r.error?"อีเมลหรือรหัสผ่านไม่ถูกต้อง":r.error),o(!1);return}localStorage.setItem("token",r.token),localStorage.setItem("user",JSON.stringify(r.user)),e.push("/master/dashboard")}catch(e){m("เกิดข้อผิดพลาด กรุณาลองใหม่"),o(!1)}};return u&&!1===l?(0,t.jsx)("div",{className:"login-container",children:(0,t.jsx)("div",{className:"spinner"})}):(0,t.jsx)("div",{className:"login-container",children:(0,t.jsxs)("div",{className:"card login-card",children:[(0,t.jsx)("h1",{className:"login-title",children:"\uD83D\uDD10 Master Panel"}),(0,t.jsx)("p",{className:"login-subtitle",children:a?"สร้างบัญชีผู้ดูแลระบบ":"เข้าสู่ระบบ"}),(0,t.jsxs)("form",{onSubmit:j,children:[a&&(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"ชื่อแสดง"}),(0,t.jsx)("input",{type:"text",className:"form-input",value:N,onChange:e=>g(e.target.value),placeholder:"Master Admin"})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"อีเมล"}),(0,t.jsx)("input",{type:"email",className:"form-input",value:d,onChange:e=>h(e.target.value),required:!0,placeholder:"admin@example.com"})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{className:"form-label",children:"รหัสผ่าน"}),(0,t.jsx)("input",{type:"password",className:"form-input",value:p,onChange:e=>f(e.target.value),required:!0,placeholder:"••••••••",minLength:6})]}),c&&(0,t.jsx)("div",{style:{color:"var(--error)",marginBottom:16,fontSize:14},children:c}),(0,t.jsx)("button",{type:"submit",className:"btn btn-primary",style:{width:"100%"},disabled:u,children:u?"กำลังดำเนินการ...":a?"สร้างบัญชี":"เข้าสู่ระบบ"})]}),l&&!a&&(0,t.jsx)("button",{onClick:()=>s(!0),className:"btn btn-secondary",style:{width:"100%",marginTop:12},children:"สร้างบัญชีผู้ดูแลระบบ"})]})})}},6046:(e,a,s)=>{"use strict";var t=s(6658);s.o(t,"useParams")&&s.d(a,{useParams:function(){return t.useParams}}),s.o(t,"usePathname")&&s.d(a,{usePathname:function(){return t.usePathname}}),s.o(t,"useRouter")&&s.d(a,{useRouter:function(){return t.useRouter}})}},e=>{var a=a=>e(e.s=a);e.O(0,[441,517,358],()=>a(2435)),_N_E=e.O()}]);