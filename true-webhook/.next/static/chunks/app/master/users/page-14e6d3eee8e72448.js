(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[986],{3278:(e,a,s)=>{Promise.resolve().then(s.bind(s,5812))},5812:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>n});var l=s(5155),r=s(2115);function n(){let[e,a]=(0,r.useState)([]),[s,n]=(0,r.useState)([]),[t,i]=(0,r.useState)(!0),[d,o]=(0,r.useState)(!1),[c,m]=(0,r.useState)(null),[h,p]=(0,r.useState)({email:"",password:"",displayName:"",role:"NETWORK_USER",networkId:""}),u=localStorage.getItem("token"),x=async()=>{let[e,s]=await Promise.all([fetch("/api/master/users",{headers:{Authorization:"Bearer ".concat(u)}}),fetch("/api/master/networks",{headers:{Authorization:"Bearer ".concat(u)}})]),l=await e.json(),r=await s.json();l.ok&&a(l.data),r.ok&&n(r.data),i(!1)};(0,r.useEffect)(()=>{x()},[]);let j=async e=>{e.preventDefault();let a=c?"/api/master/users/".concat(c):"/api/master/users",s=c?"PUT":"POST",l=c&&!h.password?{displayName:h.displayName,role:h.role,networkId:h.networkId||null}:{...h,networkId:h.networkId||null};await fetch(a,{method:s,headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(u)},body:JSON.stringify(l)}),o(!1),m(null),p({email:"",password:"",displayName:"",role:"NETWORK_USER",networkId:""}),x()},N=e=>{var a;p({email:e.email,password:"",displayName:e.displayName||"",role:e.role,networkId:(null===(a=e.network)||void 0===a?void 0:a.id)||""}),m(e.id),o(!0)},b=async e=>{confirm("ยืนยันการลบผู้ใช้?")&&(await fetch("/api/master/users/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(u)}}),x())};return t?(0,l.jsx)("div",{className:"loading",children:(0,l.jsx)("div",{className:"spinner"})}):(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"page-header",children:[(0,l.jsx)("h1",{className:"page-title",children:"จัดการผู้ใช้"}),(0,l.jsx)("button",{className:"btn btn-primary",onClick:()=>{p({email:"",password:"",displayName:"",role:"NETWORK_USER",networkId:""}),m(null),o(!0)},children:"+ เพิ่มผู้ใช้"})]}),(0,l.jsx)("div",{className:"card",children:(0,l.jsxs)("table",{className:"table",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"อีเมล"}),(0,l.jsx)("th",{children:"ชื่อ"}),(0,l.jsx)("th",{children:"บทบาท"}),(0,l.jsx)("th",{children:"เครือข่าย"}),(0,l.jsx)("th",{children:"จัดการ"})]})}),(0,l.jsx)("tbody",{children:e.map(e=>{var a;return(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:e.email}),(0,l.jsx)("td",{children:e.displayName||"-"}),(0,l.jsx)("td",{children:(0,l.jsx)("span",{className:"badge ".concat("MASTER"===e.role?"badge-warning":"badge-success"),children:e.role})}),(0,l.jsx)("td",{children:(null===(a=e.network)||void 0===a?void 0:a.name)||"-"}),(0,l.jsxs)("td",{style:{display:"flex",gap:8},children:[(0,l.jsx)("button",{className:"btn btn-secondary",style:{padding:"8px 12px"},onClick:()=>N(e),children:"แก้ไข"}),(0,l.jsx)("button",{className:"btn btn-danger",style:{padding:"8px 12px"},onClick:()=>b(e.id),children:"ลบ"})]})]},e.id)})})]})}),d&&(0,l.jsx)("div",{className:"modal-overlay",onClick:()=>o(!1),children:(0,l.jsxs)("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[(0,l.jsx)("h2",{className:"modal-title",children:c?"แก้ไขผู้ใช้":"เพิ่มผู้ใช้"}),(0,l.jsxs)("form",{onSubmit:j,children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{className:"form-label",children:"อีเมล"}),(0,l.jsx)("input",{type:"email",className:"form-input",value:h.email,onChange:e=>p({...h,email:e.target.value}),required:!0,disabled:!!c})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsxs)("label",{className:"form-label",children:["รหัสผ่าน ",c&&"(เว้นว่างหากไม่ต้องการเปลี่ยน)"]}),(0,l.jsx)("input",{type:"password",className:"form-input",value:h.password,onChange:e=>p({...h,password:e.target.value}),minLength:c?0:6,required:!c})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{className:"form-label",children:"ชื่อแสดง"}),(0,l.jsx)("input",{type:"text",className:"form-input",value:h.displayName,onChange:e=>p({...h,displayName:e.target.value})})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{className:"form-label",children:"บทบาท"}),(0,l.jsxs)("select",{className:"form-input",value:h.role,onChange:e=>p({...h,role:e.target.value}),children:[(0,l.jsx)("option",{value:"MASTER",children:"MASTER"}),(0,l.jsx)("option",{value:"NETWORK_ADMIN",children:"NETWORK_ADMIN"}),(0,l.jsx)("option",{value:"NETWORK_USER",children:"NETWORK_USER"})]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{className:"form-label",children:"เครือข่าย"}),(0,l.jsxs)("select",{className:"form-input",value:h.networkId,onChange:e=>p({...h,networkId:e.target.value}),children:[(0,l.jsx)("option",{value:"",children:"-- ไม่มี --"}),s.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,l.jsxs)("div",{className:"modal-actions",children:[(0,l.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>o(!1),children:"ยกเลิก"}),(0,l.jsx)("button",{type:"submit",className:"btn btn-primary",children:c?"บันทึก":"เพิ่ม"})]})]})]})})]})}}},e=>{var a=a=>e(e.s=a);e.O(0,[441,517,358],()=>a(3278)),_N_E=e.O()}]);